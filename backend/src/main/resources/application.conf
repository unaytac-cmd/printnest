ktor {
    deployment {
        port = 8080
        port = ${?PORT}
        host = "0.0.0.0"
        watch = [classes, resources]
    }
    application {
        modules = [com.printnest.ApplicationKt.module]
    }
    development = false
    development = ${?KTOR_DEVELOPMENT}
}

app {
    name = "PrintNest"
    version = "1.0.0"
    environment = "production"
    environment = ${?APP_ENVIRONMENT}

    baseUrl = "http://localhost:8080"
    baseUrl = ${?APP_BASE_URL}

    # Multi-tenancy
    tenancy {
        defaultTenant = "default"
        headerName = "X-Tenant-ID"
        subdomainEnabled = true
        rootDomain = "printnest.local"
        rootDomain = ${?ROOT_DOMAIN}
    }
}

database {
    driver = "org.postgresql.Driver"
    url = "jdbc:postgresql://localhost:5433/printnest"
    url = ${?DATABASE_URL}
    user = "postgres"
    user = ${?DATABASE_USER}
    password = "postgres"
    password = ${?DATABASE_PASSWORD}

    pool {
        maxSize = 20
        maxSize = ${?DATABASE_POOL_MAX_SIZE}
        minIdle = 5
        minIdle = ${?DATABASE_POOL_MIN_IDLE}
        idleTimeout = 600000
        connectionTimeout = 30000
        maxLifetime = 1800000
        leakDetectionThreshold = 60000
    }
}

redis {
    host = "localhost"
    host = ${?REDIS_HOST}
    port = 6380
    port = ${?REDIS_PORT}
    password = ""
    password = ${?REDIS_PASSWORD}
    database = 0
    ssl = false
    ssl = ${?REDIS_SSL}

    pool {
        maxTotal = 50
        maxIdle = 10
        minIdle = 5
    }
}

jwt {
    # REQUIRED: Set JWT_SECRET environment variable in production
    secret = ${JWT_SECRET}
    issuer = "printnest"
    issuer = ${?JWT_ISSUER}
    audience = "printnest-users"
    audience = ${?JWT_AUDIENCE}
    realm = "PrintNest API"

    accessToken {
        expirationMinutes = 15
        expirationMinutes = ${?JWT_ACCESS_EXPIRATION_MINUTES}
    }

    refreshToken {
        expirationDays = 30
        expirationDays = ${?JWT_REFRESH_EXPIRATION_DAYS}
    }
}

session {
    # REQUIRED: Set SESSION_SECRET environment variable in production
    secret = ${SESSION_SECRET}
    name = "PRINTNEST_SESSION"
    maxAgeSeconds = 604800
    maxAgeSeconds = ${?SESSION_MAX_AGE}
}

cors {
    allowedHosts = ["localhost:3000", "*.printnest.local", "*.printnest.com"]
    allowedHosts = ${?CORS_ALLOWED_HOSTS}
    allowCredentials = true
    maxAgeSeconds = 86400
}

stripe {
    secretKey = "sk_test_..."
    secretKey = ${?STRIPE_SECRET_KEY}
    publishableKey = "pk_test_..."
    publishableKey = ${?STRIPE_PUBLISHABLE_KEY}
    webhookSecret = "whsec_..."
    webhookSecret = ${?STRIPE_WEBHOOK_SECRET}
}

aws {
    region = "us-east-1"
    region = ${?AWS_REGION}
    accessKeyId = ""
    accessKeyId = ${?AWS_ACCESS_KEY_ID}
    secretAccessKey = ""
    secretAccessKey = ${?AWS_SECRET_ACCESS_KEY}

    s3 {
        bucket = "printnest-assets"
        bucket = ${?AWS_S3_BUCKET}
        cdnDomain = ""
        cdnDomain = ${?AWS_S3_CDN_DOMAIN}
    }

    ses {
        fromEmail = "noreply@printnest.com"
        fromEmail = ${?AWS_SES_FROM_EMAIL}
        fromName = "PrintNest"
    }

    sqs {
        orderQueueUrl = ""
        orderQueueUrl = ${?AWS_SQS_ORDER_QUEUE_URL}
        notificationQueueUrl = ""
        notificationQueueUrl = ${?AWS_SQS_NOTIFICATION_QUEUE_URL}
    }
}

easypost {
    apiKey = "EZTK..."
    apiKey = ${?EASYPOST_API_KEY}
    testMode = true
    testMode = ${?EASYPOST_TEST_MODE}
}

marketplaces {
    etsy {
        apiKey = ""
        apiKey = ${?ETSY_API_KEY}
        sharedSecret = ""
        sharedSecret = ${?ETSY_SHARED_SECRET}
        redirectUri = "http://localhost:8080/oauth/etsy/callback"
        redirectUri = ${?ETSY_REDIRECT_URI}
    }

    shopify {
        apiKey = ""
        apiKey = ${?SHOPIFY_API_KEY}
        apiSecret = ""
        apiSecret = ${?SHOPIFY_API_SECRET}
        scopes = "read_orders,write_orders,read_products,write_products"
    }

    amazon {
        clientId = ""
        clientId = ${?AMAZON_CLIENT_ID}
        clientSecret = ""
        clientSecret = ${?AMAZON_CLIENT_SECRET}
        refreshToken = ""
        refreshToken = ${?AMAZON_REFRESH_TOKEN}
        marketplaceId = "ATVPDKIKX0DER"
        marketplaceId = ${?AMAZON_MARKETPLACE_ID}
    }

    woocommerce {
        # Configured per-tenant via database
    }
}

logging {
    level = "INFO"
    level = ${?LOG_LEVEL}
    format = "json"
    format = ${?LOG_FORMAT}
}
